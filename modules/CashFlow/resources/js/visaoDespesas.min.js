$(document).ready(function(){function r(){var e=$("#anoSelect").val();t.empty();$.ajax({type:"POST",url:"modules/CashFlow/php/loadExpenses.php",data:{ano:e,userId:n},success:function(e){$(t).append(e)}})}function i(){t.empty();var e="";$.ajax({type:"POST",url:"modules/CashFlow/php/loadExpenses.php",data:{ano:e,userId:n},success:function(e){$(t).append(e)}})}function s(){var t=(new Date).getFullYear();$.ajax({type:"POST",url:"modules/CashFlow/php/loadCategories.php",data:{userId:n,ano:t},success:function(t){var n=$.parseJSON(t);for(var r=0;r<n.length;r++){if(n[r].categoryTypeId==1){e.append("<option value = "+n[r].id+">"+n[r].categoryName+"</option>")}}}})}var e=$("select[name=expenseCategory]");var t=$("#listExpenses");$("#addExpenseForm").hide();$("#deleteDialog").hide();$(".displayError").hide();$(".expenseAddSuccess").hide();var n=$("input[name=userId]").val();i();s();$("#data").datepicker({altFormat:"dd/mm/yyy",dateFormat:"dd/mm/yy",showOtherMonths:true,selectOtherMonths:true,changeMonth:true,changeYear:true});$("#txtExpenseValue").maskMoney({showSymbol:true,symbol:"R$",decimal:",",thousands:".",precision:2});$("#anoSelect").val((new Date).getFullYear()).attr("selected");$(document).ajaxStart(function(){$(".loader").show()});$(document).ajaxStop(function(){$(".loader").hide()});$("#addExpense").on("click",function(){$("#formAddExpense")[0].reset();$(".expenseAddSuccess").hide();$(".displayError").hide();$("#txtExpenseName").removeClass("redBorder");$("#addExpenseForm").dialog({modal:true,show:{effect:"slideDown",duration:600},width:500})});$("#btnCancelExpenseForm").on("click",function(){$("#addExpenseForm").dialog("destroy")});$("#listExpenses").on("click","tr:not(:last-child)",function(){if($(this).hasClass("highlighted")){$(this).removeClass("highlighted")}else{$(this).addClass("highlighted")}});$("#anoSelect").change(function(){var e=$("#anoSelect").val();t.empty();$.ajax({type:"POST",url:"modules/CashFlow/php/loadExpenses.php",data:{ano:e,userId:n},success:function(e){$(t).append(e)}})});$("#anoSelect").change(function(){var t=$("#anoSelect").val();e.empty();$.ajax({type:"POST",url:"modules/CashFlow/php/loadCategories.php",data:{ano:t,userId:n},success:function(t){var n=$.parseJSON(t);for(var r=0;r<n.length;r++){if(n[r].categoryTypeId==1){e.append("<option value = "+n[r].id+">"+n[r].categoryName+"</option>")}}}})});$("#btnAddExpense").on("click",function(){var e=$("#txtExpenseName").val();var t=$("#anoSelect").val();var i=$("#txtExpenseValue").val();var s=$("select[name=expenseCategory]").find(":selected").val();if(e==""){$("#txtExpenseName").addClass("redBorder");$(".expenseAddSuccess").hide();$(".displayError").show()}else{$.ajax({type:"POST",url:"modules/CashFlow/php/addExpense.php",data:{userId:n,expenseName:e,expenseValue:i,ano:t,category:s},success:function(e){if(e==1){$(".expenseAddSuccess").show();$(".displayError").hide();r()}}})}});$("#listExpenses").on("click","td:not(.total, :first-child)",function(){var e=$(this).text();var t=$(this).parent().attr("id");var i=$(this).attr("class");var s=$("#anoSelect").val();$(this).addClass("celulaEmEdicao");$(this).html("<input type='text' value='"+e+"' />");$(this).children().first().focus();$(this).children().first().keypress(function(e){if(e.which==13){var o=$(this).val();$(this).parent().text(o);$(this).parent().removeClass("celulaEmEdicao");$.ajax({url:"modules/CashFlow/php/updateTableField.php",data:{novoConteudo:o,rowId:t,month:i,userId:n,ano:s},type:"POST",success:function(e){r()}})}});$(this).children().first().blur(function(){$(this).parent().text(e);$(this).parent().removeClass("celulaEmEdicao")})});$("#removeExpense").on("click",function(){var e=0;var t=[];$(".highlighted").each(function(){t[e]=$(this).attr("id");e++});if(t.length>0){$("#deleteDialog").dialog({resizable:false,height:140,width:500,modal:true,buttons:{Sim:function(){var e=0;var t=[];$(".highlighted").each(function(){$(this).remove();t[e]=$(this).attr("id");e++});$.ajax({type:"POST",url:"modules/CashFlow/php/deletaDespesas.php",data:{expenses:t},success:function(e){r()}});$(this).dialog("close")},Cancelar:function(){$(this).dialog("close")}}})}else{$("#deleteDialogSelected").dialog({modal:true,buttons:{Ok:function(){$(this).dialog("close")}}})}})})