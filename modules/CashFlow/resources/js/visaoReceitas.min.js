$(document).ready(function(){function r(){var e=$("#anoSelect").val();t.empty();$.ajax({type:"POST",url:"modules/CashFlow/php/loadIncomes.php",data:{ano:e,userId:n},success:function(e){$(t).append(e)}})}function i(){t.empty();var e="";$.ajax({type:"POST",url:"modules/CashFlow/php/loadIncomes.php",data:{ano:e,userId:n},success:function(e){$(t).append(e)}})}function s(){var t=(new Date).getFullYear();$.ajax({type:"POST",url:"modules/CashFlow/php/loadCategories.php",data:{userId:n,ano:t},success:function(t){var n=$.parseJSON(t);var r="";for(var i=0;i<n.length;i++){if(n[i].categoryTypeId==2){r+="<option value = "+n[i].id+">"+n[i].categoryName+"</option>"}}e.append(r)}})}var e=$("select[name=incomeCategory]");var t=$("#listIncomes");$("#addIncomeForm").hide();$("#deleteDialog").hide();$(".displayError").hide();$(".incomeAddSuccess").hide();var n=$("input[name=userId]").val();i();s();$("#incomeDate").datepicker({altFormat:"dd/mm/yyy",dateFormat:"dd/mm/yy",showOtherMonths:true,selectOtherMonths:true,changeMonth:true,changeYear:true});$("#txtIncomeValue").maskMoney({showSymbol:true,symbol:"R$",decimal:",",thousands:"."});$("#anoSelect").val((new Date).getFullYear()).attr("selected");$(document).ajaxStart(function(){$(".loader").show()});$(document).ajaxStop(function(){$(".loader").hide()});$("#addIncome").on("click",function(){$("#formAddIncome")[0].reset();$(".incomeAddSuccess").hide();$(".displayError").hide();$("#txtIncomeName").removeClass("redBorder");$("#txtIncomeName").removeClass("greenBorder");$("#addIncomeForm").dialog({modal:true,show:{effect:"slideDown",duration:600},width:500})});$("#btnCancelIncomeForm").on("click",function(){$("#addIncomeForm").dialog("destroy")});$("#listIncomes").on("click","tr:not(:last-child)",function(){if($(this).hasClass("highlighted")){$(this).removeClass("highlighted")}else{$(this).addClass("highlighted")}});$("#anoSelect").change(function(){var e=$("#anoSelect").val();t.empty();$.ajax({type:"POST",url:"modules/CashFlow/php/loadIncomes.php",data:{ano:e,userId:n},success:function(e){$(t).append(e)}})});$("#anoSelect").change(function(){var t=$("#anoSelect").val();e.empty();$.ajax({type:"POST",url:"modules/CashFlow/php/loadCategories.php",data:{ano:t,userId:n},success:function(t){var n=$.parseJSON(t);var r="";for(var i=0;i<n.length;i++){if(n[i].categoryTypeId==2){r+="<option value = "+n[i].id+">"+n[i].categoryName+"</option>"}}e.append(r)}})});$("#txtIncomeName").keyup(function(){if($(this).val()==""){$(this).removeClass("greenBorder");$(this).addClass("redBorder")}else{$(this).addClass("greenBorder");$(this).removeClass("redBorder")}});$("#txtIncomeName").focusout(function(){if($(this).val()==""){$(this).removeClass("greenBorder");$(this).addClass("redBorder")}else{$(this).addClass("greenBorder");$(this).removeClass("redBorder")}});$("#btnAddIncome").on("click",function(){var e=$("#txtIncomeName").val();var t=$("#anoSelect").val();var i=$("#txtIncomeValue").val();var s=$("select[name=incomeCategory]").find(":selected").val();if($("#txtIncomeName").hasClass("redBorder")){$(".incomeAddSuccess").hide();$(".displayError").show()}else if(s==""){alert("Favor informe ao menos uma categoria");$(".incomeAddSuccess").hide();$(".displayError").hide()}else{$.ajax({type:"POST",url:"modules/CashFlow/php/addIncome.php",data:{userId:n,incomeName:e,incomeValue:i,ano:t,category:s},success:function(e){$("#formAddIncome")[0].reset();$("#txtIncomeName").removeClass("greenBorder");if(e==1){$(".incomeAddSuccess").show();$(".displayError").hide();r()}}})}});$("#listIncomes").on("click","td:not(.total, :first-child)",function(){var e=$(this).text();var t=$(this).parent().attr("id");var i=$(this).attr("class");var s=$("#anoSelect").val();$(this).addClass("celulaEmEdicao");$(this).html("<input type='text' value='"+e+"' />");$(this).children().first().focus();$(this).children().first().keypress(function(e){if(e.which==13){var o=$(this).val();$(this).parent().text(o);$(this).parent().removeClass("celulaEmEdicao");$.ajax({url:"modules/CashFlow/php/updateTableField.php",data:{novoConteudo:o,rowId:t,month:i,userId:n,ano:s},type:"POST",success:function(e){r()}})}});$(this).children().first().blur(function(){$(this).parent().text(e);$(this).parent().removeClass("celulaEmEdicao")})});$("#removeIncome").on("click",function(){var e=0;var t=[];$(".highlighted").each(function(){t[e]=$(this).attr("id");e++});if(t.length>0){$("#deleteDialog").dialog({resizable:false,height:140,width:500,modal:true,buttons:{Sim:function(){var e=0;var t=[];$(".highlighted").each(function(){$(this).remove();t[e]=$(this).attr("id");e++});$.ajax({type:"POST",url:"modules/CashFlow/php/deletaReceitas.php",data:{incomes:t},success:function(e){r()}});$(this).dialog("close")},Cancelar:function(){$(this).dialog("close")}}})}else{$("#deleteDialogSelected").dialog({modal:true,buttons:{Ok:function(){$(this).dialog("close")}}})}})})