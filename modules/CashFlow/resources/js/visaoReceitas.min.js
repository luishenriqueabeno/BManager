$(document).ready(function(){function e(){var e=$("#anoSelect").val();n.empty(),$.ajax({type:"POST",url:"modules/CashFlow/php/loadIncomes.php",data:{ano:e,userId:s},success:function(e){$(n).append(e)}})}function a(){n.empty();var e="";$.ajax({type:"POST",url:"modules/CashFlow/php/loadIncomes.php",data:{ano:e,userId:s},success:function(e){$(n).append(e)}})}function t(){var e=(new Date).getFullYear();$.ajax({type:"POST",url:"modules/CashFlow/php/loadCategories.php",data:{userId:s,ano:e},success:function(e){for(var a=$.parseJSON(e),t=0;t<a.length;t++)2==a[t].categoryTypeId&&o.append("<option value = "+a[t].id+">"+a[t].categoryName+"</option>")}})}var o=$("select[name=incomeCategory]"),n=$("#listIncomes");$("#addIncomeForm").hide(),$("#deleteDialog").hide(),$(".displayError").hide(),$(".incomeAddSuccess").hide();var s=$("input[name=userId]").val();a(),t(),$("#incomeDate").datepicker({altFormat:"dd/mm/yyy",dateFormat:"dd/mm/yy",showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0}),$("#txtIncomeValue").maskMoney({showSymbol:!0,symbol:"R$",decimal:",",thousands:"."}),$("#anoSelect").val((new Date).getFullYear()).attr("selected"),$(document).ajaxStart(function(){$(".loader").show()}),$(document).ajaxStop(function(){$(".loader").hide()}),$("#addIncome").on("click",function(){$("#formAddIncome")[0].reset(),$(".incomeAddSuccess").hide(),$(".displayError").hide(),$("#txtIncomeName").removeClass("redBorder"),$("#addIncomeForm").dialog({modal:!0,show:{effect:"slideDown",duration:600},width:500})}),$("#btnCancelIncomeForm").on("click",function(){$("#addIncomeForm").dialog("destroy")}),$("#listIncomes").on("click","tr:not(:last-child)",function(){$(this).hasClass("highlighted")?$(this).removeClass("highlighted"):$(this).addClass("highlighted")}),$("#anoSelect").change(function(){var e=$("#anoSelect").val();n.empty(),$.ajax({type:"POST",url:"modules/CashFlow/php/loadIncomes.php",data:{ano:e,userId:s},success:function(e){$(n).append(e)}})}),$("#anoSelect").change(function(){var e=$("#anoSelect").val();o.empty(),$.ajax({type:"POST",url:"modules/CashFlow/php/loadCategories.php",data:{ano:e,userId:s},success:function(e){for(var a=$.parseJSON(e),t=0;t<a.length;t++)2==a[t].categoryTypeId&&o.append("<option value = "+a[t].id+">"+a[t].categoryName+"</option>")}})}),$("#btnAddIncome").on("click",function(){var a=$("#txtIncomeName").val(),t=$("#anoSelect").val(),o=$("#txtIncomeValue").val(),n=$("select[name=incomeCategory]").find(":selected").val();""==a?($("#txtIncomeName").addClass("redBorder"),$(".incomeAddSuccess").hide(),$(".displayError").show()):$.ajax({type:"POST",url:"modules/CashFlow/php/addIncome.php",data:{userId:s,incomeName:a,incomeValue:o,ano:t,category:n},success:function(a){1==a&&($(".incomeAddSuccess").show(),$(".displayError").hide(),e())}})}),$("#listIncomes").on("click","td:not(.total, :first-child)",function(){var a=$(this).text(),t=$(this).parent().attr("id"),o=$(this).attr("class"),n=$("#anoSelect").val();$(this).addClass("celulaEmEdicao"),$(this).html("<input type='text' value='"+a+"' />"),$(this).children().first().focus(),$(this).children().first().keypress(function(a){if(13==a.which){var c=$(this).val();$(this).parent().text(c),$(this).parent().removeClass("celulaEmEdicao"),$.ajax({url:"modules/CashFlow/php/updateTableField.php",data:{novoConteudo:c,rowId:t,month:o,userId:s,ano:n},type:"POST",success:function(){e()}})}}),$(this).children().first().blur(function(){$(this).parent().text(a),$(this).parent().removeClass("celulaEmEdicao")})}),$("#removeIncome").on("click",function(){var e=0,a=[];$(".highlighted").each(function(){a[e]=$(this).attr("id"),e++}),a.length>0?$("#deleteDialog").dialog({resizable:!1,height:140,width:500,modal:!0,buttons:{Sim:function(){var e=0,a=[];$(".highlighted").each(function(){$(this).remove(),a[e]=$(this).attr("id"),e++}),$.ajax({type:"POST",url:"modules/CashFlow/php/deletaReceitas.php",data:{incomes:a},success:function(){}}),$(this).dialog("close")},Cancelar:function(){$(this).dialog("close")}}}):$("#deleteDialogSelected").dialog({modal:!0,buttons:{Ok:function(){$(this).dialog("close")}}})})});